<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Playground - Book API</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --primary: #00d2ff; --secondary: #0066ff; --dark-bg: #030712; --sidebar-w: 280px; --glass-bg: rgba(15, 23, 42, 0.75); --border: rgba(255, 255, 255, 0.15); }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(to bottom, rgba(3, 7, 18, 0.8), rgba(3, 7, 18, 0.95)), url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&q=80&w=2000'); 
            background-size: cover; 
            background-attachment: fixed; 
            color: #ffffff; 
            min-height: 100vh; 
            margin: 0; 
            overflow-x: hidden; 
        }
        
        .dashboard-layout { display: flex; width: 100%; overflow-x: hidden; }

        .main-content { 
            margin-left: var(--sidebar-w); 
            flex: 1; 
            padding: 50px 60px; 
            max-width: 1400px;
        }

        .page-header h2 { font-weight: 800; font-size: 2.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        
        .glass-card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(25px); 
            border: 1px solid var(--border); 
            border-radius: 30px; 
            padding: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        }

        .input-label { 
            font-size: 0.8rem; 
            font-weight: 900; 
            color: var(--primary); 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            margin-bottom: 14px; 
            display: block; 
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.3);
        }
        
        .form-control-custom { 
            background: rgba(255,255,255,0.08); 
            border: 2px solid var(--border); 
            color: #fff; 
            padding: 16px 20px; 
            border-radius: 15px; 
            font-weight: 700; 
            font-size: 1rem;
            transition: 0.3s; 
            cursor: pointer;
        }

        .form-control-custom:focus { 
            border-color: var(--primary); 
            background: rgba(255,255,255,0.12); 
            outline: none; 
            box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.2); 
            color: #fff; 
        }

        .form-control-custom option {
            background: #0f172a;
            color: #fff;
            padding: 12px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-control-custom option:hover {
            background: var(--primary);
            color: #000;
        }

        .btn-send { 
            background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            color: #000; 
            border: none; 
            font-weight: 900; 
            padding: 18px; 
            border-radius: 16px; 
            width: 100%; 
            transition: 0.3s; 
            box-shadow: 0 10px 20px rgba(0, 210, 255, 0.4); 
            text-transform: uppercase; 
        }

        .btn-send:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0, 210, 255, 0.6); }

        .response-json { 
            background: #0d1117; 
            border-radius: 20px; 
            padding: 25px; 
            color: #c9d1d9; 
            font-family: 'Fira Code', monospace; 
            border: 1px solid var(--border); 
            max-height: 500px; 
            overflow-y: auto; 
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .btn-explorer {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
            padding: 16px;
            border-radius: 15px;
            font-weight: 800;
            width: 100%;
            margin-top: 15px;
            transition: 0.3s;
            font-size: 0.95rem;
        }

        .btn-explorer:hover {
            background: var(--primary);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.5);
            transform: translateY(-2px);
        }

        @media (max-width: 992px) {
            .main-content { margin-left: 0; padding: 100px 20px; }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <!-- Sidebar Container -->
        <div id="navbar-container"></div>

        <main class="main-content">
            <header class="page-header mb-5">
                <h5 class="text-primary fw-bold mb-2"><i class="fas fa-flask-vial me-2"></i>ENVIRONMENT UJI COBA</h5>
                <h2>API Playground</h2>
                <p class="text-white-50">Lakukan simulasi permintaan API untuk memvalidasi data aplikasi Anda.</p>
            </header>

            <div class="row g-4">
                <!-- Konfigurasi Request -->
                <div class="col-lg-4">
                    <div class="glass-card">
                        <div class="mb-4">
                            <span class="input-label">1. Authentication Key</span>
                            <input type="text" id="playApiKey" class="form-control-custom w-100" placeholder="sk_...">
                        </div>
                        <div class="mb-4">
                            <span class="input-label">2. Select Endpoint</span>
                            <select id="playEndpoint" class="form-control-custom w-100">
                                <option value="/api/books">üìö GET /api/books ‚Äî Katalog Buku</option>
                                <option value="/api/categories">üè∑Ô∏è GET /api/categories ‚Äî Daftar Kategori</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <span class="input-label">3. Parameter Pencarian (Judul / Kategori)</span>
                            <input type="text" id="playSearch" class="form-control-custom w-100" placeholder="Contoh: Technology, Novel, dll...">
                        </div>
                        <button onclick="runTest()" id="btnSend" class="btn btn-send">
                            Kirim Request <i class="fas fa-paper-plane ms-2"></i>
                        </button>
                        
                        <button onclick="goToExplorer()" class="btn btn-explorer">
                            <i class="fas fa-images me-2"></i>BUKA VISUAL EXPLORER
                        </button>
                    </div>
                </div>

                <!-- Respon JSON -->
                <div class="col-lg-8">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="badge bg-white bg-opacity-10 px-4 py-2 border rounded-pill fw-bold">
                            Status: <span id="resStatus" class="text-primary">-</span>
                        </div>
                    </div>
                    <div class="glass-card" style="min-height: 500px;">
                        <pre id="jsonContent" class="response-json">Menunggu permintaan request...</pre>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="navbar.js"></script>
    <script>
        // Inisialisasi Navbar
        initNavbar('playground');

        // Isi API Key otomatis jika tersedia di session
        const currentKey = localStorage.getItem('book_api_key'); 
        if (currentKey) document.getElementById('playApiKey').value = currentKey;

        /**
         * Navigasi ke Halaman Explorer (Netflix Style)
         */
        function goToExplorer() {
            const search = document.getElementById('playSearch').value.trim();
            
            // Selalu arahkan ke explorer dengan parameter search
            if (search) {
                window.location.href = `explorer.html?search=${encodeURIComponent(search)}`;
            } else {
                window.location.href = 'explorer.html';
            }
        }

        /**
         * Eksekusi Test API
         */
        async function runTest() {
            const key = document.getElementById('playApiKey').value;
            let endpoint = document.getElementById('playEndpoint').value;
            const searchVal = document.getElementById('playSearch').value.trim();
            const btnSend = document.getElementById('btnSend');
            const resStatus = document.getElementById('resStatus');
            const jsonContent = document.getElementById('jsonContent');
            
            if (!key) return Swal.fire('Error', 'API Key wajib diisi!', 'warning');

            // Bangun URL dengan parameter pencarian
            let finalUrl = endpoint;
            if (searchVal) {
                finalUrl += `?search=${encodeURIComponent(searchVal)}`;
            }

            // UI State: Loading
            btnSend.disabled = true;
            btnSend.innerHTML = '<i class="fas fa-circle-notch fa-spin me-2"></i>Memproses...';
            resStatus.innerText = "Processing...";
            jsonContent.textContent = "Mengambil data dari server...";
            
            try {
                const res = await fetch(finalUrl, { 
                    headers: { 'x-api-key': key } 
                });
                const result = await res.json();

                // Tampilkan Status & Hasil
                resStatus.innerText = `${res.status} ${res.statusText}`;
                resStatus.className = res.ok ? "text-success fw-bold" : "text-danger fw-bold";
                jsonContent.textContent = JSON.stringify(result, null, 2);

                if(res.ok && endpoint === '/api/books') {
                    Swal.fire({ 
                        title: 'Data Diterima!', 
                        text: 'Ingin melihat hasil pencarian ini dalam tampilan Gallery Visual?', 
                        icon: 'success', 
                        showCancelButton: true, 
                        confirmButtonText: 'Buka Explorer', 
                        cancelButtonText: 'Tetap di JSON',
                        background: '#0f172a', 
                        color: '#fff',
                        confirmButtonColor: '#00d2ff'
                    }).then((r) => { 
                        if(r.isConfirmed) goToExplorer(); 
                    });
                } else if(res.ok) {
                    Swal.fire({ 
                        title: 'Berhasil!', 
                        text: 'Data berhasil dimuat.', 
                        icon: 'success',
                        background: '#0f172a', 
                        color: '#fff',
                        confirmButtonColor: '#00d2ff'
                    });
                } else {
                    Swal.fire('Gagal', result.message || 'Kunci API salah atau tidak aktif.', 'error');
                }
            } catch (err) { 
                Swal.fire('Gagal', 'Terjadi kesalahan koneksi ke server.', 'error');
                resStatus.innerText = "Error";
                jsonContent.textContent = "Gagal memuat data. Periksa koneksi backend.";
            } finally {
                btnSend.disabled = false;
                btnSend.innerHTML = 'Kirim Request <i class="fas fa-paper-plane ms-2"></i>';
            }
        }
    </script>
</body>
</html>